resources:
    any_of:
    accelerators: A100:1

envs:
    MODEL_NAME: HuggingFaceH4/zephyr-7b-beta
    TOKENIZER: HuggingFaceH4/zephyr-7b-beta

run: |
    git clone https://github.com/vllm-project/vllm.git
    cd vllm
    DOCKER_BUILDKIT=1 docker build . --target vllm --tag vllm --build-arg max_jobs=8
    docker run --runtime nvidia --gpus all \
        -v ~/.cache/huggingface:/root/.cache/huggingface \
        -p 8000:8000 \
        vllm \
        --model $MODEL_NAME \
        --tensor-parallel-size $SKYPILOT_NUM_GPUS_PER_NODE \
        --tokenizer $TOKENIZER
